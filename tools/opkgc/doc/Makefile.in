### Makefile.in for opkgc templates
###
### Copyright 2007 ORNL
###     Geoffroy Vallee <valleegr@ornl.gov>
### Copyright 2007 INRIA-IRISA
###     Jean Parpaillon <jean.parpaillon@irisa.fr>
###
SOURCES = opkgc-manual.xml
SCHEMAS = opkg.xsd

DISTFILES = $(SOURCES) $(SCHEMAS) $(EXTRA_DIST) 
DISTCLEAN_FILES = $(EXTRA_DISTCLEAN_FILES) Makefile

CLEAN_FILES = $(EXTRA_CLEAN_FILES)

PACKAGE_TARNAME=@PACKAGE_TARNAME@
srcdir=@srcdir@
prefix=@prefix@
sysconfdir=/etc
datadir=@datadir@
datarootdir=@datarootdir@
pkgdatadir=@datadir@/@PACKAGE@
docdir=@docdir@
htmldir=@htmldir@
pdfdir=@docdir@
mkdir_p = @mkdir_p@
INSTALL = @install_sh@
INSTALL_DATA = @INSTALL_DATA@

DB2PDF=db2pdf
DB2HTML=db2html

ifeq ("@PDFDOC@","yes")
PDF_TARGETS=$(patsubst %.xml,%.pdf,$(SOURCES))
else
PDF_TARGETS=
endif
ifeq ("@HTMLDOC@","yes")
HTML_TARGETS=$(patsubst %.xml,%,$(SOURCES))
else
HTML_TARGETS=
endif
ifeq ("@ONEHTMLDOC@","yes")
ONE_HTML_TARGETS=$(patsubst %.xml,%.html,$(SOURCES))
else
ONE_HTML_TARGETS=
endif

ALL_TARGETS=$(PDF_TARGETS) $(HTML_TARGETS) $(ONE_HTML_TARGETS)

all: $(ALL_TARGETS)

pdf: $(PDF_TARGETS)

html: $(HTML_TARGETS)

one-html: $(ONE_HTML_TARGETS)

%.pdf: %.xml
	$(DB2PDF) $< 

%.html: %.xml
	$(DB2HTML) -o . --nochunks $<
	rm -rf $*
	[ -d $*.junk ] && mv $*.junk $*

%: %.xml
	$(DB2HTML) $<

distdir: $(DISTFILES)
	for distfile in $(DISTFILES); do \
	  distfile_dir=`dirname $$distfile`; \
	  if test "$$distfile_dir" = "$(srcdir)"; then \
	    rsync -av --exclude '.svn' --exclude '*~' $$distfile $(distdir); \
	  else \
	    test -d $(distdir)/$$distfile_dir || $(mkdir_p) $(distdir)/$$distfile_dir; \
	    rsync -av --exclude '.svn' --exclude '*~' $$distfile $(distdir)/$$distfile_dir; \
	  fi; \
	done

install: install-data
install-data: $(ALL_TARGETS) $(SCHEMA)
	if test "$(PDF_TARGETS)" != ""; then \
	  for t in "$(PDF_TARGETS)"; do \
	    $(mkdir_p) "$(DESTDIR)$(pdfdir)"; \
	    $(INSTALL_DATA) "$$t" "$(DESTDIR)$(pdfdir)/$$t"; \
	  done; \
	fi
	if test "$(ONE_HTML_TARGETS)" != ""; then \
	  for t in "$(ONE_HTML_TARGETS)"; do \
	    $(mkdir_p) "$(DESTDIR)$(htmldir)"; \
	    $(INSTALL_DATA) "$$t" "$(DESTDIR)$(htmldir)/$$t"; \
	  done; \
	fi
	if test "$(HTML_TARGETS)" != ""; then \
	  for t in "$(HTML_TARGETS)"; do \
	    $(mkdir_p) "$(DESTDIR)$(htmldir)/$$t"; \
	    ( cd $$t; \
	      $(INSTALL_DATA) * "$(DESTDIR)$(htmldir)/$$t"; \
	    ) \
	  done; \
	fi
	for t in "$(SCHEMAS)"; do \
	  $(mkdir_p) "$(DESTDIR)$(pkgdatadir)"; \
	  $(INSTALL_DATA) "$$t" "$(DESTDIR)$(pkgdatadir)/$$t"; \
	done

uninstall: uninstall-data
uninstall-data: 
	rm -rf $(DESTDIR)$(pdfdir)
	rm -rf $(DESTDIR)$(htmldir)
	rm -rf $(DESTDIR)$(pkgdatadir)

clean:
	rm -rf $(ALL_TARGETS) $(CLEAN_FILES) *~

distclean: clean
	rm -rf $(DISTCLEAN_FILES)