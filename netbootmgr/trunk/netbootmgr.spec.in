# $Id: netbootmgr.spec 6252 2007-04-13 12:06:10Z focht $
Summary: Manage next network boot action for a cluster
Name: netbootmgr
Version: __VERSION__
Vendor: NEC HPCE
Release: 1%{?dist}
License: GPL
Packager: Erich Focht <efocht@hpce.nec.com>
Source: %{name}-%{version}.tar.gz
Group: System Environment/Tools
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}
BuildRequires: perl-Qt
Requires: perl-Qt
Requires: memtest86+
#AutoReqProv: no

%description 
Netbootmgr provides a GUI interface for managing the next boot action for
network booted hosts. It does so by using pxelinux' or elilo.efi's capability
to load an IP specific configuration file from the network. Netbootmgr
creates/deletes symbolic links pointing to predefined pxelinux/elilo config
files.

%prep
%setup -n %{name}-%{version}


%build
# currently the puic path is hardcoded
/usr/bin/puic4 -o netBootMgr.pm netbootmgr.ui
/usr/bin/puic4 -o sureDialog.pm suredialog.ui

%install

for dir in %{_bindir} %{_datarootdir}/%{name} %{_sysconfdir} %{_mandir}/man8 ; do
    install -d -o root -g root -m 755 $RPM_BUILD_ROOT$dir
done
for file in netbootmgr netbootmgr-status/* netbootmgr-cmd ; do
    base=`basename $file`
    install -o root -g root -m 755 $file $RPM_BUILD_ROOT%{_bindir}/$base
done
for file in *.pm; do
    install -o root -g root -m 755 $file %{perl_vendorlib}
done

for file in localboot kernel-x memtest86 hostdb.test ; do
    install -o root -g root -m 755 $file $RPM_BUILD_ROOT%{_datarootdir}/%{name}
done
install -o root -g root -m 755 netbootmgr.conf $RPM_BUILD_ROOT%{_sysconfdir}
install -o root -g root -m 644 netbootmgr.8 $RPM_BUILD_ROOT%{_mandir}/man8

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%doc README LICENSE-GPL2 ChangeLog AUTHORS
%{_bindir}/*
%{_datarootdir}/%{name}/*
%{perl_vendorlib}/*
%{_mandir}/man8/netbootmgr.*

%post
if [ -d /tftpboot ]; then
   for f in localboot kernel-x memtest86 memtest86+-1.65.bin; do
      if [ ! -f /tftpboot/$f ]; then
         cp -p /usr/share/netbootmgr/$f /tftpboot
      fi
   done
fi

%preun
# remove installed sample files if last instance of netbootmgr
# is being erased
if [ $1 -eq 0 ]; then
   for f in localboot kernel-x memtest86 memtest86+-1.65.bin; do
      if [ -f /tftpboot/$f ]; then
         rm -f /tftpboot/$f
      fi
   done
fi

%changelog
* Fri Jul  5 2014 Olivier Lahaye 1.8-2
- Reworked the spec file.
* Fri Jul  5 2014 DongInn Kim 1.8-1
- Port to perl-Qt (Qt4)
* Fri Apr 13 2007 Erich Focht 1.7-1
- added verbose variable for netbootlib
- added netbootmgr-cmd as command line interface for netbootmgr functionality
* Tue Feb 13 2007 Erich Focht 1.6-1
- fixed issue with ID LED not working.
* Tue Feb 13 2007 Erich Focht 1.5-1
- added cpower support for node status and power actions
* Fri Nov 04 2005 Erich Focht
- added man page
- added %post section, copying some sample files to /tftpboot
- added %preun section for deleting sample files from /tftpboot
* Wed Nov 02 2005 Erich Focht
- initial RPM
